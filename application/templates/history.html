{% extends 'layout.html' %}
<!-- Dark background img -->
{% set background_image = 'images/dark_bg.jpg' %}
{% block content %}

    <button id="show-stats-btn">View Prediction Stats</button>

    <div class="modal-history" id="stats-modal">
        <div class="modal-history-content">
            <h3>Prediction Stats Summary</h3>
            <p>Total Predictions: {{ generations.total }}</p>
            <p>Average Prediction Time: {{ average_prediction_time }} seconds</p>
            <p>Success Rate: {{ success_rate }}%</p>
            <form id="stats-filter-form">
                <label for="date-range">Date Range:</label>
                <input type="date" id="start-date" name="start-date">
                <input type="date" id="end-date" name="end-date">
                <button type="submit">Filter</button>
            </form>
            <button class="close-btn" onclick="closeModal()">Close</button>
        </div>
    </div>


    <!-- Main Content -->
    <div class="main-content">
        <!-- If no predictions, display a message and link to create a new prediction -->
        {% if not generations.items %}
            <!-- Add a dynamic greeting message with the username -->   
            <div class="no-history-container">
                <p class="intro-text">Hello, {{ username }}!</p>
                <p class="no-history-message">It looks like you have no history yet.</p>
                <p><a href="{{ url_for('routes.generate') }}" class="create-prediction-link">Create a new generation?</a></p>
            </div>
        {% else %}
            <p class="intro-text">Hello, {{ username }}! Below is your personal Image Generation history:</p>
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Image</th>
                        <th scope="col">Class Label</th>
                        <th scope="col">Model</th>
                        <th scope="col">Predicted On</th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for generation in generations %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>
                                <!-- Display the image -->
                                <img src="{{ generation.image_url }}" alt="Generated Image" style="max-width: 100px;">
                            </td>
                            <td>{{ generation.class_label }}</td>
                            <td>{{ generation.model_name }}</td>
                            <td>{{ generation.predicted_on }}</td>
                            <td>
                                <!-- Add any actions you want here, e.g., delete, edit, etc. -->
                                <a href="#" class="btn-sm btn-danger">Delete</a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <!-- Pagination Links -->
            <nav aria-label="Page navigation">
                <ul class="pagination">
                    {% if generations.has_prev %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for('routes.history', page=generations.prev_num) }}">Previous</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <span class="page-link">Previous</span>
                        </li>
                    {% endif %}
                    
                    {% for page_num in generations.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
                        {% if page_num %}
                            {% if page_num == generations.page %}
                                <li class="page-item active">
                                    <span class="page-link">{{ page_num }}</span>
                                </li>
                            {% else %}
                                <li class="page-item">
                                    <a class="page-link" href="{{ url_for('routes.history', page=page_num) }}">{{ page_num }}</a>
                                </li>
                            {% endif %}
                        {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                        {% endif %}
                    {% endfor %}
                    
                    {% if generations.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for('routes.history', page=generations.next_num) }}">Next</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <span class="page-link">Next</span>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        {% endif %}
    </div>
{% endblock %}